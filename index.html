<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Attendance System — Fixed</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* ---------- Base (Mobile First) ---------- */
body{
  font-family:Arial,sans-serif;
  margin:10px;
  background:#f9f9f9;
  font-size:14px;
}
nav{
  background:#0077cc;
  padding:10px;
  border-radius:8px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
nav a{
  color:#fff;
  text-decoration:none;
  padding:6px 8px;
  border-radius:5px;
  background:#0090ff;
  text-align:center;
}
nav a:hover{background:#005fa3;}
table{
  border-collapse:collapse;
  width:100%;
  margin-top:15px;
  background:#fff;
  font-size:13px;
  overflow-x:auto;
  display:block; /* mobile scroll */
  white-space:nowrap;
}
th,td{border:1px solid #ccc;padding:5px;text-align:center;}
th{background:#0077cc;color:#fff;}
.green{background:#c8e6c9;}
.yellow{background:#fff9c4;}
.red{background:#ffcdd2;}
form{
  background:#fff;
  padding:12px;
  margin-top:15px;
  border-radius:8px;
}
.error{color:red;font-size:0.85em;display:block;margin-bottom:6px;}
#message{color:green;font-weight:bold;margin-top:8px;min-height:1.1em;}
#report{
  margin-top:15px;
  background:#fff;
  padding:8px;
  border-radius:8px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
}
.chart-box{width:140px;height:140px;}
.chart-box canvas{width:140px!important;height:140px!important;}
button{
  margin-top:6px;
  margin-right:6px;
  padding:6px 10px;
  border:none;
  background:#0077cc;
  color:#fff;
  border-radius:5px;
  cursor:pointer;
}
button:hover{background:#005fa3;}
/* ---------- Tablet & Desktop ---------- */
@media(min-width:769px){
  body{font-size:15px;margin:20px;}
  nav{flex-direction:row;justify-content:center;}
  nav a{background:none;padding:8px 12px;}
  table{display:table;white-space:normal;}
  #report{flex-direction:row;justify-content:center;}
  .chart-box{width:180px;height:180px;}
  .chart-box canvas{width:180px!important;height:180px!important;}
}
</style>

</head>
<body>

<nav>
  <a href="#">Home</a>
  <a href="#">Attendance List</a>
  <a href="#">Add Student</a>
  <a href="#">Reports</a>
  <a href="#">Logout</a>
</nav>

<h2>Attendance Table</h2>
<table id="attendanceTable">
  <thead>
    <tr>
      <th rowspan="2">Last Name</th>
      <th rowspan="2">First Name</th>
      <th colspan="2">S1</th>
      <th colspan="2">S2</th>
      <th colspan="2">S3</th>
      <th colspan="2">S4</th>
      <th colspan="2">S5</th>
      <th colspan="2">S6</th>
      <th rowspan="2">Absences</th>
      <th rowspan="2">Participation</th>
      <th rowspan="2">Message</th>
    </tr>
    <tr>
      <th>P</th><th>Pa</th>
      <th>P</th><th>Pa</th>
      <th>P</th><th>Pa</th>
      <th>P</th><th>Pa</th>
      <th>P</th><th>Pa</th>
      <th>P</th><th>Pa</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Ahmed</td><td>Sara</td>
      <td><input type="checkbox" checked></td><td><input type="checkbox" checked></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td></td><td></td><td></td>
    </tr>
    <tr>
      <td>Yacine</td><td>Ali</td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox" checked></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox" checked></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td></td><td></td><td></td>
    </tr>
    <tr>
      <td>Houcine</td><td>Rania</td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox" checked></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox" checked></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td></td><td></td><td></td>
    </tr>
  </tbody>
</table>

<h3>Add New Student</h3>
<form id="addStudentForm" novalidate>
  <label>Student ID:</label>
  <input type="text" id="studentId"><br>
  <span class="error" id="idError"></span>

  <label>Last Name:</label>
  <input type="text" id="lastName"><br>
  <span class="error" id="lastError"></span>

  <label>First Name:</label>
  <input type="text" id="firstName"><br>
  <span class="error" id="firstError"></span>

  <label>Email:</label>
  <input type="text" id="email"><br>
  <span class="error" id="emailError"></span>

  <button type="submit">Submit</button>
</form>

<div id="message"></div>

<div style="margin-top:12px;">
  <button id="showReport">Show Report</button>
  <button id="highlightExcellent">Highlight Excellent Students</button>
  <button id="resetColors">Reset Colors</button>
</div>

<div id="report" style="display:none;">
  <div class="chart-box"><canvas id="absenceChart"></canvas></div>
  <div id="report-stats" style="font-size:14px;"></div>
</div>

<script>
const table=document.getElementById("attendanceTable");
let chartInstance=null;

function updateTable(){
  const rows=table.querySelectorAll("tbody tr");
  rows.forEach(row=>{
    const boxes=row.querySelectorAll("input[type='checkbox']");
    let abs=0,par=0;
    for(let i=0;i<boxes.length;i+=2){
      if(!boxes[i].checked)abs++;
      if(boxes[i+1].checked)par++;
    }
    row.children[row.children.length-3].textContent=`${abs} Abs`;
    row.children[row.children.length-2].textContent=`${par} Par`;
    let m="";
    if(abs<3){row.className="green";m="Good attendance – Excellent participation";}
    else if(abs<=4){row.className="yellow";m="Warning – attendance low – participate more";}
    else{row.className="red";m="Excluded – too many absences";}
    row.children[row.children.length-1].textContent=m;
  });
}
updateTable();

table.addEventListener("change",e=>{
  if(e.target.type==="checkbox")updateTable();
});

const form=document.getElementById("addStudentForm");
form.addEventListener("submit",e=>{
  e.preventDefault();
  const id=document.getElementById("studentId").value.trim();
  const ln=document.getElementById("lastName").value.trim();
  const fn=document.getElementById("firstName").value.trim();
  const em=document.getElementById("email").value.trim();
  const errs={id:"idError",ln:"lastError",fn:"firstError",em:"emailError"};
  document.getElementById(errs.id).textContent="";
  document.getElementById(errs.ln).textContent="";
  document.getElementById(errs.fn).textContent="";
  document.getElementById(errs.em).textContent="";
  let valid=true;
  if(!/^[0-9]+$/.test(id)){document.getElementById(errs.id).textContent="Numbers only";valid=false;}
  if(!/^[A-Za-z]+$/.test(ln)){document.getElementById(errs.ln).textContent="Letters only";valid=false;}
  if(!/^[A-Za-z]+$/.test(fn)){document.getElementById(errs.fn).textContent="Letters only";valid=false;}
  if(!/^[^@]+@[^@]+\.[a-z]+$/.test(em)){document.getElementById(errs.em).textContent="Invalid email";valid=false;}
  if(!valid)return;
  const row=document.createElement("tr");
  row.innerHTML=`<td>${ln}</td><td>${fn}</td>${"<td><input type='checkbox'></td><td><input type='checkbox'></td>".repeat(6)}<td></td><td></td><td></td>`;
  table.querySelector("tbody").appendChild(row);
  updateTable();
  form.reset();
  document.getElementById("message").textContent="Student added successfully!";
  setTimeout(()=>document.getElementById("message").textContent="",3000);
});

document.getElementById("showReport").addEventListener("click",()=>{
  const rows=table.querySelectorAll("tbody tr");
  let totalAbs=0,totalPar=0;
  rows.forEach(r=>{
    totalAbs+=parseInt(r.children[r.children.length-3].textContent)||0;
    totalPar+=parseInt(r.children[r.children.length-2].textContent)||0;
  });
  const ctx=document.getElementById("absenceChart").getContext("2d");
  if(chartInstance)chartInstance.destroy();
  chartInstance=new Chart(ctx,{type:"doughnut",data:{labels:["Absences","Participation"],datasets:[{data:[totalAbs,totalPar],backgroundColor:["#f44336","#4caf50"]}]},options:{responsive:false,maintainAspectRatio:false,plugins:{title:{display:true,text:"Attendance Report"}}}});
  document.getElementById("report-stats").innerHTML=`<strong>Total absences:</strong> ${totalAbs}<br><strong>Total participations:</strong> ${totalPar}`;
  document.getElementById("report").style.display="flex";
});

$(function(){
  $("#attendanceTable tbody")
    .on("mouseenter","tr",function(){$(this).css("outline","2px solid #0077cc");})
    .on("mouseleave","tr",function(){$(this).css("outline","none");})
    .on("click","tr",function(){
      const last=$(this).children("td").eq(0).text();
      const first=$(this).children("td").eq(1).text();
      const abs=$(this).children("td").eq($(this).children().length-3).text();
      alert(`${last} ${first} has ${abs}`);
    });
  $("#highlightExcellent").on("click",function(){
    $("#attendanceTable tbody tr").each(function(){
      const abs=parseInt($(this).children("td").eq($(this).children().length-3).text())||0;
      if(abs<3)$(this).fadeOut(160).fadeIn(160);
    });
  });
  $("#resetColors").on("click",function(){
    $("#attendanceTable tbody tr").css("outline","none");
    updateTable();
  });
});
</script>
</body>
</html>
